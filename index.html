<!DOCTYPE html>
<html lang="en" dir="ltr" class="loading">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Claude Chat Assistant — Powered by Claude 3.7 AI</title>
    
    <!-- Core meta -->
    <meta name="description" content="Experience intelligent conversations with Claude 3.7 AI. Enhanced with thinking mode for complex reasoning, code generation, creative writing, and problem solving.">
    <meta name="theme-color" content="#7e57c2" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1a20" media="(prefers-color-scheme: dark)">
    <meta name="color-scheme" content="light dark">
    <meta name="application-name" content="Claude Chat">
    
    <!-- Security -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'nonce-{{CSP_NONCE}}' https://storage.googleapis.com; connect-src 'self' https://api.anthropic.com; img-src 'self' data: blob:; style-src 'self' 'nonce-{{CSP_NONCE}}' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; worker-src 'self'; manifest-src 'self'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; report-uri https://claudechat.example.com/csp-report">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=(), camera=(), microphone=(), geolocation=()">
    
    <!-- PWA capability discovery -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Claude Chat">
    <meta name="msapplication-TileColor" content="#7e57c2">
    <meta name="msapplication-config" content="assets/img/browserconfig.xml">
    
    <!-- SEO -->
    <meta name="keywords" content="AI assistant, Claude 3.7, AI chat, thinking mode, AI coding, language model, reasoning, creative writing, AI problem solver, GPT alternative">
    <meta name="author" content="Anthropic Claude">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://claudechat.example.com">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://claudechat.example.com">
    <meta property="og:title" content="Claude Chat — Intelligent AI Assistant">
    <meta property="og:description" content="Experience intelligent conversations with Claude 3.7 AI. Enhanced with thinking mode for complex reasoning, code generation, creative writing, and problem solving.">
    <meta property="og:image" content="https://claudechat.example.com/assets/img/og-image.webp">
    <meta property="og:site_name" content="Claude Chat">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter / X -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://claudechat.example.com">
    <meta property="twitter:title" content="Claude Chat — Intelligent AI Assistant">
    <meta property="twitter:description" content="Experience intelligent conversations with Claude 3.7 AI. Enhanced with thinking mode for complex reasoning, code generation, creative writing, and problem solving.">
    <meta property="twitter:image" content="https://claudechat.example.com/assets/img/twitter-image.webp">
    <meta name="twitter:creator" content="@anthropic">
    
    <!-- Favicon / App Icons -->
    <link rel="icon" type="image/svg+xml" href="assets/img/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
    <link rel="mask-icon" href="assets/img/safari-pinned-tab.svg" color="#7e57c2">
    <link rel="shortcut icon" href="assets/img/favicon.ico">
    
    <!-- Critical CSS (inlined for performance) -->
    <style nonce="{{CSP_NONCE}}">
        :root {
            --primary-color: #7e57c2;
            --primary-dark: #4d2c91;
            --primary-light: #b085f5;
            --bg-color: #f8f9fb;
            --surface-color: #ffffff;
            --text-color: #1a1a20;
            --text-secondary: #71717a;
            --border-color: #e4e4e7;
            --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'Fira Code', SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
        }
        .dark-theme {
            --primary-color: #9575cd;
            --primary-dark: #b085f5;
            --primary-light: #4d2c91;
            --bg-color: #121212;
            --surface-color: #1e1e24;
            --text-color: #f1f1f3;
            --text-secondary: #a1a1aa;
            --border-color: #27272a;
        }
        html.loading {
            visibility: hidden;
            opacity: 0;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        body {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .app-container {
            display: flex;
            flex: 1;
            height: 100%;
            overflow: hidden;
        }
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 0;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            z-index: 100;
            transition: top 0.3s;
        }
        .skip-to-content:focus {
            top: 0;
            outline: 2px solid var(--primary-light);
        }
        .loader {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            z-index: 9999;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .loader svg {
            width: 60px;
            height: 60px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }
    </style>
    
    <!-- Preload important assets -->
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/js/app.js" as="script">
    <link rel="preload" href="assets/js/component-loader.js" as="script" type="module">
    <link rel="preload" href="assets/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="assets/img/logo.svg" as="image" type="image/svg+xml">
    <link rel="preload" href="assets/templates/chat-interface.html" as="fetch" crossorigin>
    <link rel="preload" href="assets/templates/header-component.html" as="fetch" crossorigin>
    
    <!-- Preconnect to important origins -->
    <link rel="preconnect" href="https://api.anthropic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Stylesheets (non-critical) -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/chat.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/settings.css">
    <link rel="stylesheet" href="assets/css/utils.css" media="print" onload="this.media='all'">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Claude Chat Assistant",
      "description": "Anthropic Claude 3.7 AI assistant with thinking capabilities",
      "applicationCategory": ["Productivity", "Utility", "Communication"],
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "Anthropic",
        "url": "https://www.anthropic.com",
        "logo": "https://claudechat.example.com/assets/img/anthropic-logo.png"
      },
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "softwareVersion": "2.0.0",
      "screenshot": "https://claudechat.example.com/assets/img/screenshot-wide.webp",
      "featureList": [
        "AI Chat",
        "Thinking Mode",
        "Code Generation",
        "File Analysis",
        "Creative Writing"
      ]
    }
    </script>
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#chatContainer" class="skip-to-content">Skip to content</a>
    
    <!-- Initial loading screen -->
    <div class="loader" id="initialLoader" aria-label="Loading application">
        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="22.08" x2="12" y2="12" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>
    
    <!-- Main application container -->
    <div class="app-container">
        <!-- Sidebar - loaded via component loader -->
        <div id="sidebarContainer"></div>

        <!-- Main content area -->
        <main class="main-content" aria-live="polite">
            <!-- Header - loaded via component loader -->
            <div id="headerContainer"></div>
            
            <!-- Chat interface - loaded via component loader -->
            <div id="chatInterfaceContainer"></div>
        </main>

        <!-- Settings Panel - loaded via component loader -->
        <div id="settingsPanelContainer"></div>
    </div>
    
    <!-- Overlay for modals and panels -->
    <div class="overlay" id="overlay" aria-hidden="true"></div>
    
    <!-- Toast notification container -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Live region for screen readers -->
    <div id="sr-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Modal dialogs container - filled by component loader -->
    <div id="modalContainer"></div>
    
    <!-- File share target handler (hidden) -->
    <input type="hidden" id="sharedContent">
    
    <!-- Scripts with module support -->
    <script nonce="{{CSP_NONCE}}">
        // Store nonce for dynamic script creation
        window.securityNonce = '{{CSP_NONCE}}';
        
        // Feature detection
        document.documentElement.classList.add('js-enabled');
        if ('loading' in HTMLImageElement.prototype) {
            document.documentElement.classList.add('loading-attribute-enabled');
        }
        
        // Modern browser detection
        const isModernBrowser = 'noModule' in HTMLScriptElement.prototype;
        document.documentElement.classList.toggle('modern-browser', isModernBrowser);
    </script>
    
    <!-- Component loader -->
    <script type="module" src="assets/js/component-loader.js" nonce="{{CSP_NONCE}}"></script>
    
    <!-- Core scripts -->
    <script src="assets/js/utils.js" defer nonce="{{CSP_NONCE}}"></script>
    <script src="assets/js/theme.js" defer nonce="{{CSP_NONCE}}"></script>
    <script src="assets/js/api.js" defer nonce="{{CSP_NONCE}}"></script>
    <script src="assets/js/ui.js" defer nonce="{{CSP_NONCE}}"></script>
    <script src="assets/js/settings.js" defer nonce="{{CSP_NONCE}}"></script>
    <script src="assets/js/app.js" defer nonce="{{CSP_NONCE}}"></script>
    
    <!-- Application initialization -->
    <script type="module" nonce="{{CSP_NONCE}}">
        import componentLoader from './assets/js/component-loader.js';

        // Initialize components when DOM content is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Load the sidebar component
                await componentLoader.renderComponent(
                    'assets/templates/sidebar-component.html',
                    document.getElementById('sidebarContainer')
                );
                
                // Load the header component
                await componentLoader.renderComponent(
                    'assets/templates/header-component.html',
                    document.getElementById('headerContainer'),
                    {
                        title: 'Claude 3.7 Thinking',
                        modelName: 'Claude 3.7 Sonnet'
                    }
                );
                
                // Load the chat interface component
                await componentLoader.renderComponent(
                    'assets/templates/chat-interface.html',
                    document.getElementById('chatInterfaceContainer'),
                    {
                        showWelcome: true,
                        thinkingBudget: '10,240',
                        thinkingModeEnabled: true,
                        examplePrompts: [
                            'Explain quantum computing to a 10-year-old',
                            'Write a JavaScript function to detect palindromes',
                            'Analyze the strengths and weaknesses of different web frameworks',
                            'Create an outline for a blog post about AI safety'
                        ]
                    }
                );
                
                // Load the settings panel component
                await componentLoader.renderComponent(
                    'assets/templates/settings-panel.html',
                    document.getElementById('settingsPanelContainer')
                );
                
                // Signal that components are loaded
                window.dispatchEvent(new CustomEvent('components-loaded'));
                
                // Hide loader
                setTimeout(() => {
                    const loader = document.getElementById('initialLoader');
                    if (loader) {
                        loader.style.opacity = '0';
                        setTimeout(() => {
                            loader.style.display = 'none';
                            document.documentElement.classList.remove('loading');
                        }, 300);
                    } else {
                        document.documentElement.classList.remove('loading');
                    }
                }, 200);
            } catch (error) {
                console.error('Error initializing components:', error);
                document.documentElement.classList.remove('loading');
                const errorMessage = document.createElement('div');
                errorMessage.className = 'error-message';
                errorMessage.textContent = 'An error occurred loading the application. Please refresh the page to try again.';
                document.body.appendChild(errorMessage);
            }
        });
    </script>
    
    <!-- Service Worker Registration -->
    <script nonce="{{CSP_NONCE}}">
        // Register service worker after page load
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available - load and show update notification
                                    componentLoader.renderComponent(
                                        'assets/templates/modal-dialogs.html#updateNotificationTemplate',
                                        document.getElementById('modalContainer')
                                    ).then(() => {
                                        const updateNotification = document.getElementById('updateNotification');
                                        if (updateNotification) {
                                            updateNotification.removeAttribute('hidden');
                                            
                                            const updateButton = document.getElementById('updateButton');
                                            if (updateButton) {
                                                updateButton.addEventListener('click', () => {
                                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                                });
                                            }
                                            
                                            const dismissButton = document.getElementById('dismissUpdate');
                                            if (dismissButton) {
                                                dismissButton.addEventListener('click', () => {
                                                    updateNotification.setAttribute('hidden', '');
                                                });
                                            }
                                        }
                                    });
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
                
                // Handle controller change (service worker update)
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (!refreshing) {
                        refreshing = true;
                        window.location.reload();
                    }
                });
            });
        }
        
        // Check for shared content (Web Share Target API)
        if ('serviceWorker' in navigator && window.location.search.includes('share=true')) {
            const getSharedContent = async () => {
                try {
                    const db = await new Promise((resolve, reject) => {
                        const request = indexedDB.open('claude-chat-db', 1);
                        request.onerror = () => reject(request.error);
                        request.onsuccess = () => resolve(request.result);
                    });
                    
                    const data = await new Promise((resolve, reject) => {
                        const transaction = db.transaction('shared-content', 'readonly');
                        const store = transaction.objectStore('shared-content');
                        const request = store.get('latest-share');
                        request.onerror = () => reject(request.error);
                        request.onsuccess = () => resolve(request.result);
                    });
                    
                    if (data) {
                        document.getElementById('sharedContent').value = JSON.stringify(data);
                        window.dispatchEvent(new CustomEvent('shared-content-ready', { detail: data }));
                    }
                } catch (error) {
                    console.error('Error reading shared content:', error);
                }
            };
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', getSharedContent);
            } else {
                getSharedContent();
            }
        }
    </script>
</body>
</html>